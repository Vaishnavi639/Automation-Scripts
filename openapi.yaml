openapi: 3.0.0
info:
  title: Afto API (Auto-Generated)
  version: 1.0.0
servers:
  - url: https://api.example.com
paths:
  /admin/authenticate:
	  post:
	    tags:
	      - Admin
	    summary: Authenticate an admin user using Google ID token
	    description: |
	      Authenticates an admin user by verifying their **Google OAuth2 ID token**.

	      ### **How it works**
	      1. The client sends a `clientIdToken` (Google ID token).
	      2. The server verifies the token with Google using `google-auth-library`.
	      3. Extracts the user's email from the Google payload.
	      4. Looks up the admin user in the database using that email.
	      5. Returns:
		 - `isAdmin: true` + `id` if the user exists  
		 - `404 Invalid User` if no admin record exists

	      ### **Authentication**
	      No prior authentication required — this endpoint is used **to authenticate** an admin.

	    operationId: authenticateAdmin
	    security: []   # noAuth()
	    requestBody:
	      required: true
	      content:
		application/json:
		  schema:
		    type: object
		    required:
		      - clientIdToken
		    properties:
		      clientIdToken:
		        type: string
		        description: Google OAuth2 ID token obtained from client-side authentication
		        example: "eyJhbGciOiJSUzI1NiIsImtpZCI6IjE2YT..."
		  examples:
		    validToken:
		      summary: Valid Google ID token
		      value:
		        clientIdToken: "eyJhbGciOiJSUzI1NiIsImtpZCI6IjE2YT..."

	    responses:
	      '200':
		description: Admin authentication successful
		content:
		  application/json:
		    schema:
		      type: object
		      properties:
		        id:
		          type: string
		          description: Unique identifier of the admin user
		          example: "admin_123"
		        isAdmin:
		          type: boolean
		          example: true
		        message:
		          type: string
		          example: "Successfully fetched admin for authentication!"
		    examples:
		      adminAuthenticated:
		        summary: Admin user authenticated successfully
		        value:
		          id: "admin_123"
		          isAdmin: true
		          message: "Successfully fetched admin for authentication!"

	      '404':
		description: Invalid user (Google token verified, but email not found in admin table)
		content:
		  application/json:
		    schema:
		      $ref: "#/components/schemas/Error"
		    examples:
		      invalidUser:
		        summary: Admin email not found
		        value:
		          code: 404
		          message: "Invalid User"
		          statusCode: 404

	      '400':
		description: Invalid or malformed Google token
		content:
		  application/json:
		    schema:
		      $ref: "#/components/schemas/Error"
		    examples:
		      invalidGoogleToken:
		        summary: Google ID token verification failed
		        value:
		          error: "Invalid Token"
		          message: "Google ID token could not be verified"
		          statusCode: 400

	      '500':
		description: Internal error while verifying or fetching admin
		content:
		  application/json:
		    schema:
		      $ref: "#/components/schemas/Error"
		    examples:
		      internalError:
		        summary: Unexpected server failure
		        value:
		          error: "Internal Server Error"
		          message: "Failed to fetch admin for authentication!"
		          statusCode: 500

  /admin:
	  post:
	    tags:
	      - Admin
	    summary: Create a new admin user
	    description: |
	      Creates a new admin user in the system.

	      ### **Behavior**
	      - Generates a unique `id` using UUID.
	      - Stores `name` and `email` in the admin database table.
	      - Returns the created admin record on success.

	      ### **Authentication**
	      No authentication required.  
	      This endpoint is used during initial setup or admin creation workflows.

	    operationId: createAdmin
	    security: []   # noAuth()

	    requestBody:
	      required: true
	      content:
		application/json:
		  schema:
		    type: object
		    required:
		      - name
		      - email
		    properties:
		      name:
		        type: string
		        description: Full name of the admin user
		        example: "John Doe"
		      email:
		        type: string
		        format: email
		        description: Email address of the admin (must be unique)
		        example: "john.doe@example.com"

		  examples:
		    validRequest:
		      summary: Create admin request
		      value:
		        name: "John Doe"
		        email: "john.doe@example.com"

	    responses:
	      '200':
		description: Admin successfully created
		content:
		  application/json:
		    schema:
		      type: object
		      properties:
		        id:
		          type: string
		          description: UUID of the newly created admin user
		          example: "550e8400-e29b-41d4-a716-446655440000"
		        name:
		          type: string
		          example: "John Doe"
		        email:
		          type: string
		          example: "john.doe@example.com"
		        message:
		          type: string
		          example: "Successfully created admin"
		    examples:
		      successResponse:
		        summary: Successfully created admin
		        value:
		          id: "550e8400-e29b-41d4-a716-446655440000"
		          name: "John Doe"
		          email: "john.doe@example.com"
		          message: "Successfully created admin"

	      '400':
		description: Invalid input or missing fields
		content:
		  application/json:
		    schema:
		      $ref: "#/components/schemas/Error"
		    examples:
		      missingFields:
		        summary: Required fields missing
		        value:
		          error: "Invalid Request"
		          message: "Name and email are required"
		          statusCode: 400

	      '409':
		description: Admin with this email already exists
		content:
		  application/json:
		    schema:
		      $ref: "#/components/schemas/Error"
		    examples:
		      duplicateEmail:
		        summary: Email already registered
		        value:
		          error: "Conflict"
		          message: "Admin with this email already exists"
		          statusCode: 409

	      '500':
		description: Internal server error during admin creation
		content:
		  application/json:
		    schema:
		      $ref: "#/components/schemas/Error"
		    examples:
		      internalError:
		        summary: Database failure
		        value:
		          error: "Internal Server Error"
		          message: "Failed to create admin"
		          statusCode: 500


   /admin/users:
  get:
    tags:
      - Admin
    summary: Fetch all users with pagination and search
    description: |
      Retrieves a paginated list of users from the system.  
      Supports optional search and pagination parameters.

      ### **Behavior**
      - If `page` or `limit` is not provided, defaults are applied at query level.
      - If `searchTerm` is provided, users are filtered based on matching fields (typically name/email).
      - Uses `FetchAllUsers` DB query internally.

      ### **Authentication**
      Although `.withSecurity().noAuth()` is used,  
      there is **no token requirement** for this endpoint.

    operationId: getAllUsers
    security: []   # noAuth()

    parameters:
      - in: query
        name: page
        required: false
        schema:
          type: integer
          example: 1
        description: Page number for pagination

      - in: query
        name: limit
        required: false
        schema:
          type: integer
          example: 10
        description: Number of users to return per page

      - in: query
        name: searchTerm
        required: false
        schema:
          type: string
          example: "john"
        description: Search term to filter users (name, email, etc.)

    responses:
      '200':
        description: Successfully fetched all users
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: array
                  description: List of users
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "user_123"
                      name:
                        type: string
                        example: "John Doe"
                      email:
                        type: string
                        example: "john@example.com"
                total:
                  type: integer
                  description: Total number of matching users
                  example: 42
                page:
                  type: integer
                  example: 1
                limit:
                  type: integer
                  example: 10
                message:
                  type: string
                  example: "Successfully fetched all users!"
            examples:
              success:
                summary: Successful fetch
                value:
                  data:
                    - id: "user_123"
                      name: "John Doe"
                      email: "john@example.com"
                    - id: "user_456"
                      name: "Jane Smith"
                      email: "jane.smith@example.com"
                  total: 2
                  page: 1
                  limit: 10
                  message: "Successfully fetched all users!"

      '400':
        description: Invalid pagination values or query parameters
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
            examples:
              invalidPage:
                summary: Invalid page or limit
                value:
                  error: "Invalid Parameters"
                  message: "Page and limit must be valid integers"
                  statusCode: 400

      '500':
        description: Internal server error while fetching users
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
            examples:
              internalError:
                summary: Database error
                value:
                  error: "Internal Server Error"
                  message: "Failed to fetch all users!"
                  statusCode: 500


/admin/authenticate/:email:
  get:
    tags:
      - Admin
    summary: Generate authentication token for an admin user
    description: |
      Generates a JWT token for an admin user based on their email address.

      ### **How it works**
      1. Client calls this endpoint with `email` as a path parameter.
      2. The system looks up the admin using `GetAdminByEmailQuery`.
      3. If the admin exists:
         - A JWT token is generated using `@mvp-rockets/namma-lib`.
         - The token includes admin details (`id`, `name`, `email`, `isAdmin`).
      4. If no admin is found:
         - A `404 Invalid User` response is returned.

      ### **Authentication**
      No authentication required — this endpoint **returns** a token.

    operationId: generateAdminToken
    security: []   # noAuth()

    parameters:
      - in: path
        name: email
        required: true
        schema:
          type: string
          format: email
          example: "admin@example.com"
        description: Email address of the admin user

    responses:
      '200':
        description: Successfully generated admin authentication token
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  description: Unique identifier of the admin
                  example: "admin_123"
                token:
                  type: string
                  description: Generated JWT authentication token
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                isAdmin:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "Successfully fetched admin for authentication!"
            examples:
              success:
                summary: Admin token generated successfully
                value:
                  id: "admin_123"
                  token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  isAdmin: true
                  message: "Successfully fetched admin for authentication!"

      '404':
        description: Admin user not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
            examples:
              invalidUser:
                summary: Admin email not found
                value:
                  code: 404
                  message: "Invalid User"
                  statusCode: 404

      '400':
        description: Invalid email format
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
            examples:
              invalidEmail:
                summary: Bad email format
                value:
                  error: "Invalid Email"
                  message: "Email must be a valid email address"
                  statusCode: 400

      '500':
        description: Internal server error while generating token
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
            examples:
              internalError:
                summary: Unexpected server error
                value:
                  error: "Internal Server Error"
                  message: "Failed to fetch admin for authentication!"
                  statusCode: 500

 
